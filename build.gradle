/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

plugins {
    id 'java'
}

group 'sergey'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
    compile group: 'log4j', name: 'log4j', version: '1.2.17'
    compile group: 'org.apache.commons', name: 'commons-io', version: '1.3.2'
}

classes.doLast() {
    
    def stringGreeting = file('src/main/resources/greeting.txt').getText()
    // Version check
    if(stringGreeting.contains('ver.')){
        String[] versionArray = stringGreeting.split('ver.')
        version = versionArray[1]   
        println("Build version : " + version)
    }else {
        version = 1
        file('src/main/resources/greeting.txt').text = stringGreeting +' '+'ver.1'
    }
}
// Java method catalog pointing and copy 
class IncrementalTask extends DefaultTask {
    @InputDirectory
    def File inputDir

    @OutputDirectory
    def File outputDir

    @Input
    def inputProperty

    @TaskAction
    void execute(IncrementalTaskInputs inputs) {
        inputs.outOfDate { change ->
            println "out of date: ${change.file.name}"
            def targetFile = new File(outputDir, change.file.name)
            targetFile.text = change.file.text.toString()
        }
    }
}
// Task for increment
task incrementalUpdate(type: IncrementalTask) {

    
    String s = file('src/main/resources/greeting.txt').getText()

    if(s.contains('ver.')) {
        println(s)
        String[] versionArray = s.split("ver.")
        int versionNumber = versionArray[1] as Integer
        int increment = versionNumber + 1  // inkrement
        println(versionArray[0] + " split " + versionArray[1] + "eeeee" + increment)
        println(versionNumber)
        
        file('src/main/resources/greeting.txt').text = versionArray[0] + 'ver.' + increment
    }

    println("incrementalReversedfdbdfbdfb")
    inputDir = file('src/main/resources/')
    outputDir = file("$buildDir/build/resourses/main/greeting.txt")
    inputProperty = project.properties['taskInputProperty'] ?: 'original'
    println("incrementalReversedfdbdfbdfb")

}


